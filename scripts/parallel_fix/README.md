# å¹¶è¡Œç¼–è¯‘ä¿®å¤å·¥ä½œæµ v2.0

ä¸€å¥—æ¨¡å—åŒ–ã€å¯æ‰©å±•çš„å¹¶è¡Œç¼–è¯‘é”™è¯¯ä¿®å¤ç³»ç»Ÿã€‚

## å¿«é€Ÿå¼€å§‹

```bash
# 1. åˆ†æç¼–è¯‘é”™è¯¯å¹¶ç”Ÿæˆä»»åŠ¡
./scripts/parallel_fix/analyze.sh build.log

# 2. æ‰§è¡Œå¹¶è¡Œä¿®å¤
./scripts/parallel_fix/run.sh

# 3. éªŒè¯ä¿®å¤ç»“æœ
make 2>&1 | tee build_after_fix.log
```

## å·¥ä½œæµæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä¸»æ§åˆ¶å™¨ (run.sh)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Agent 1  â”‚   â”‚ Agent 2  â”‚   â”‚ Agent 3  â”‚   â”‚ Agent N  â”‚      â”‚
â”‚  â”‚ ç¨€ç–API  â”‚   â”‚ æ¨¡æ¿å‚æ•° â”‚   â”‚ è¯­æ³•é”™è¯¯ â”‚   â”‚   ...    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â”‚
â”‚       â”‚              â”‚              â”‚              â”‚            â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                              â”‚                                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                    â”‚   çŠ¶æ€æ–‡ä»¶ (.state)  â”‚                      â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ–‡ä»¶ç»“æ„

```
scripts/parallel_fix/
â”œâ”€â”€ README.md           # æœ¬æ–‡æ¡£
â”œâ”€â”€ run.sh              # ä¸»æ§åˆ¶å™¨
â”œâ”€â”€ analyze.sh          # é”™è¯¯åˆ†æå™¨
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ common.sh       # é€šç”¨å‡½æ•°åº“
â”‚   â”œâ”€â”€ state.sh        # çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ templates.sh    # æ¨¡æ¿ç”Ÿæˆ
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ base.txt        # åŸºç¡€æ¨¡æ¿
â”‚   â”œâ”€â”€ sparse_api.txt  # ç¨€ç–çŸ©é˜µAPIæ¨¡æ¿
â”‚   â”œâ”€â”€ template_param.txt
â”‚   â”œâ”€â”€ type_cast.txt
â”‚   â””â”€â”€ syntax.txt
â””â”€â”€ .state/             # è¿è¡Œæ—¶çŠ¶æ€ (gitignore)
    â”œâ”€â”€ tasks.json      # ä»»åŠ¡å®šä¹‰
    â”œâ”€â”€ status          # ç®€å•çŠ¶æ€æ–‡ä»¶
    â””â”€â”€ logs/           # ä»»åŠ¡æ—¥å¿—
```

## æ ¸å¿ƒæ”¹è¿›

### 1. ç®€åŒ–çš„çŠ¶æ€åè®®

ä¸å†ä½¿ç”¨å¤æ‚çš„ JSON + jqï¼Œæ”¹ç”¨ç®€å•çš„è¡Œå¼æ–‡ä»¶ï¼š

```
# .state/status æ ¼å¼
TASK_ID:STATUS:TIMESTAMP:MESSAGE
1:completed:2024-12-29T10:30:00:ä¿®å¤å®Œæˆ
2:in_progress:2024-12-29T10:30:05:æ­£åœ¨å¤„ç†
3:pending:::
```

æ›´æ–°çŠ¶æ€åªéœ€è¿½åŠ ä¸€è¡Œï¼š
```bash
echo "1:completed:$(date -Is):ä¿®å¤å®Œæˆ" >> .state/status
```

### 2. æ¨¡æ¿ç»§æ‰¿ç³»ç»Ÿ

åŸºç¡€æ¨¡æ¿ + ç‰¹åŒ–æ¨¡æ¿ï¼Œå‡å°‘é‡å¤ï¼š

```bash
# ç”Ÿæˆå®Œæ•´prompt
generate_prompt() {
    cat templates/base.txt
    cat templates/$TASK_TYPE.txt
    inject_variables "$TASK_ID" "$TARGET_FILES" "$LOCATIONS"
}
```

### 3. è‡ªåŠ¨é”™è¯¯åˆ†æ

ä»ç¼–è¯‘æ—¥å¿—è‡ªåŠ¨ç”Ÿæˆä»»åŠ¡ï¼š

```bash
./analyze.sh build.log
# è¾“å‡º:
# å‘ç° 6 ä¸ªç‹¬ç«‹ä»»åŠ¡:
# - Task 1: sparse_api (alignment.hpp) - 47 errors
# - Task 2: sparse_api (coexpression.hpp) - 23 errors
# ...
```

### 4. å®æ—¶ç›‘æ§

å†…ç½®ç›‘æ§ï¼Œæ— éœ€é¢å¤–å‘½ä»¤ï¼š

```bash
./run.sh --monitor
# è‡ªåŠ¨æ˜¾ç¤ºå®æ—¶è¿›åº¦æ¡å’ŒçŠ¶æ€
```

## éš¾åº¦çº§åˆ«ç³»ç»Ÿ

ç³»ç»Ÿæ”¯æŒä¸‰ç§éš¾åº¦çº§åˆ«ï¼Œæ¯ç§çº§åˆ«ä½¿ç”¨ä¸åŒçš„æ¨¡å‹å’Œé…ç½®ï¼š

| éš¾åº¦ | é€‚ç”¨åœºæ™¯ | é»˜è®¤æ¨¡å‹ | æ€è€ƒæ¨¡å¼ |
|------|----------|----------|----------|
| `easy` | ç¼ºå°‘å¤´æ–‡ä»¶ã€ç®€å•è¯­æ³•é”™è¯¯ | Haiku | å…³é—­ |
| `normal` | APIè¿ç§»ã€æ¨¡æ¿å‚æ•°ä¿®å¤ | Sonnet 4 | å…³é—­ |
| `hard` | å¤æ‚é€»è¾‘é‡æ„ã€è·¨æ–‡ä»¶ä¾èµ– | Sonnet 4 | å¼€å¯ |

### æŒ‡å®šéš¾åº¦

**ä»»åŠ¡æ–‡ä»¶ä¸­æŒ‡å®š**ï¼š
```json
{
  "id": "1",
  "type": "syntax",
  "files": ["src/complex.hpp"],
  "difficulty": "hard"
}
```

**å‘½ä»¤è¡Œå…¨å±€è¦†ç›–**ï¼š
```bash
# å¼ºåˆ¶æ‰€æœ‰ä»»åŠ¡ä½¿ç”¨ hard æ¨¡å¼
./run.sh --difficulty hard tasks.json
```

**è‡ªåŠ¨æ£€æµ‹**ï¼š
å¦‚æœä¸æŒ‡å®šéš¾åº¦ï¼Œç³»ç»Ÿä¼šæ ¹æ®ä»»åŠ¡ç±»å‹è‡ªåŠ¨æ£€æµ‹ï¼š
- `missing_header`, `simple_syntax` â†’ easy
- `sparse_api`, `template_param`, `type_cast`, `api_binding` â†’ normal
- `syntax`, `complex_refactor`, `cross_file_dependency` â†’ hard

### æŸ¥çœ‹é…ç½®

```bash
./run.sh --show-config
# æ˜¾ç¤ºå½“å‰éš¾åº¦çº§åˆ«å¯¹åº”çš„æ¨¡å‹é…ç½®
```

## é…ç½®

ç¼–è¾‘ `.parallel_fix.conf` è‡ªå®šä¹‰è®¾ç½®ï¼š

```bash
# æœ€å¤§å¹¶è¡Œä»»åŠ¡æ•°
MAX_PARALLEL=8

# æ˜¯å¦åœ¨æ¯ä¸ªä»»åŠ¡åéªŒè¯ç¼–è¯‘
VERIFY_AFTER_TASK=false

# å¤±è´¥é‡è¯•æ¬¡æ•°
RETRY_COUNT=1

# ============================================================
# éš¾åº¦çº§åˆ«æ¨¡å‹é…ç½®
# ============================================================

# Easy: ç®€å•ä»»åŠ¡
EASY_MODEL="claude-3-5-haiku-20241022"
EASY_THINK=false
EASY_MAX_TOKENS=4096

# Normal: å¸¸è§„ä»»åŠ¡
NORMAL_MODEL="claude-sonnet-4-20250514"
NORMAL_THINK=false
NORMAL_MAX_TOKENS=8192

# Hard: å¤æ‚ä»»åŠ¡ - å¯ç”¨æ·±åº¦æ€è€ƒ
HARD_MODEL="claude-sonnet-4-20250514"
HARD_THINK=true
HARD_MAX_TOKENS=16384

# é»˜è®¤éš¾åº¦çº§åˆ«
DEFAULT_DIFFICULTY="normal"
```

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬æµç¨‹

```bash
# 1. ç¼–è¯‘å¹¶æ•è·é”™è¯¯
make 2>&1 | tee build.log

# 2. åˆ†æé”™è¯¯ç”Ÿæˆä»»åŠ¡
./scripts/parallel_fix/analyze.sh build.log -o tasks.json

# 3. é¢„è§ˆä»»åŠ¡ï¼ˆå¹²è¿è¡Œï¼‰
./scripts/parallel_fix/run.sh --dry-run tasks.json

# 4. æ‰§è¡Œä¿®å¤
./scripts/parallel_fix/run.sh tasks.json

# 5. éªŒè¯
make
```

### äº¤äº’å¼æ¨¡å¼ ğŸ†•

äº¤äº’æ¨¡å¼ä¼šè‡ªåŠ¨å‘é€ç¬¬ä¸€ä¸ªä»»åŠ¡çš„promptï¼Œç„¶åè®©ä½ ç»§ç»­ä¸Claudeå¯¹è¯ï¼š

```bash
# äº¤äº’å¼ä¿®å¤ - è‡ªåŠ¨å¼€å§‹å¯¹è¯
./scripts/parallel_fix/run.sh --interactive tasks.json

# äº¤äº’æ¨¡å¼ + hardéš¾åº¦
./scripts/parallel_fix/run.sh -i --difficulty hard tasks.json
```

**å·¥ä½œæµç¨‹ï¼š**
1. ç³»ç»ŸåŠ è½½ç¬¬ä¸€ä¸ªä»»åŠ¡
2. è‡ªåŠ¨ç”Ÿæˆå¹¶å‘é€åˆå§‹prompt
3. Claudeå¼€å§‹å¤„ç†å¹¶å“åº”
4. **ä½ å¯ä»¥ç»§ç»­è¾“å…¥è¿½é—®ã€è°ƒæ•´è¦æ±‚ã€æŸ¥çœ‹æ›´å¤šç»†èŠ‚**
5. å®Œæˆåæ‰‹åŠ¨æ ‡è®°çŠ¶æ€ï¼ˆæˆ–é€€å‡ºï¼‰

**é€‚ç”¨åœºæ™¯ï¼š**
- å¤æ‚é—®é¢˜éœ€è¦å¤šè½®è®¨è®º
- éœ€è¦åœ¨ä¿®å¤è¿‡ç¨‹ä¸­è°ƒæ•´ç­–ç•¥
- æƒ³è¦æ·±å…¥ç†è§£é”™è¯¯åŸå› 
- éœ€è¦é€æ­¥éªŒè¯ä¿®å¤æ–¹æ¡ˆ

### é«˜çº§ç”¨æ³•

```bash
# ä½¿ç”¨ hard æ¨¡å¼å¤„ç†æ‰€æœ‰ä»»åŠ¡
./scripts/parallel_fix/run.sh --difficulty hard tasks.json

# å¸¦ç›‘æ§æ¨¡å¼è¿è¡Œ
./scripts/parallel_fix/run.sh --monitor tasks.json

# ä¸€é”®å¿«é€Ÿä¿®å¤
./scripts/parallel_fix/quick_fix.sh

# è¯¦ç»†è¾“å‡ºæ¨¡å¼
./scripts/parallel_fix/run.sh --verbose tasks.json
```

