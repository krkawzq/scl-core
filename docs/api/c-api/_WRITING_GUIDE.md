# C API Documentation Writing Guide

This guide explains how to write C API documentation using the data/content separation architecture.

## Architecture Overview

```
┌─────────────────────────────────────────────────────────────┐
│                    _data/*.yaml (Codegen)                   │
│         Structured data: params, errors, complexity         │
└─────────────────────────────────────────────────────────────┘
                              +
┌─────────────────────────────────────────────────────────────┐
│                      *.md (AI/Human)                        │
│       Descriptive content: Brief, Description, Notes        │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                   Rendered Documentation                    │
└─────────────────────────────────────────────────────────────┘
```

## File Structure

```
docs/api/c-api/
├── _data/                      # Codegen generated (DO NOT EDIT)
│   ├── algebra.yaml
│   └── normalize.yaml
├── algebra/                    # Module directory
│   ├── index.md               # Module overview (human written)
│   ├── spmv.md                # Function doc (human written)
│   └── spmm.md
└── index.md                   # C API index
```

## Writing a Function Document

### Step 1: Get the YAML Data

The YAML data is generated by codegen from C header files. Example:

```yaml
# _data/algebra.yaml
functions:
  - id: scl_algebra_spmv
    return_type: scl_error_t
    params:
      - { name: A, type: scl_sparse_t, dir: in }
      - { name: x, type: "const scl_real_t*", dir: in }
    errors:
      - { code: SCL_ERROR_NULL_POINTER, condition: If A is NULL }
    complexity: { time: O(nnz), space: O(1) }
    version: "0.4.0"
    status: stable
```

### Step 2: Write the Markdown File

Create `algebra/spmv.md`:

```markdown
---
title: scl_algebra_spmv
function: scl_algebra_spmv
module: algebra
---

<script setup>
const funcData = { /* ... paste from YAML ... */ }
</script>

# scl_algebra_spmv

<ApiFunctionRenderer :data="funcData" />

## Brief

One-line description of what the function does.

## Formula

$$y = \alpha \cdot A \cdot x + \beta \cdot y$$

## Description

Detailed description...

## FFI Stability

<Callout type="tip" title="Stable API">
This function is part of the stable C API...
</Callout>

## Data Guarantees

- List of data guarantees...

## Mutability

<Callout type="warning" title="INPLACE">
Explain in-place modifications...
</Callout>

## Thread Safety

<Callout type="info" title="Thread Safe">
Explain thread safety...
</Callout>

## Notes

- Additional notes...

<SeeAlso :links="[...]" />
```

## Required Sections

| Section | Required | Description |
|---------|----------|-------------|
| Brief | Yes | One-line function description |
| Formula | No | LaTeX formula if applicable |
| Description | Yes | Detailed explanation and use cases |
| FFI Stability | Yes | API stability guarantees |
| Data Guarantees | Yes | Input/output data promises |
| Mutability | Yes | INPLACE / ALLOCATES / CONST |
| Thread Safety | Yes | Concurrency safety level |
| Notes | No | Additional tips and edge cases |

## Callout Types

Use these callout types for semantic meaning:

```markdown
<Callout type="tip" title="Stable API">...</Callout>     <!-- Positive info -->
<Callout type="warning" title="INPLACE">...</Callout>   <!-- Caution needed -->
<Callout type="info" title="Thread Safe">...</Callout>  <!-- Neutral info -->
<Callout type="danger" title="Unsafe">...</Callout>     <!-- Critical warning -->
```

## Data from YAML vs Content from Markdown

| Source | Data Type |
|--------|-----------|
| YAML (Codegen) | Function signature, parameters, errors, complexity, version, status, source location |
| Markdown (Human) | Brief, formula, description, stability notes, data guarantees, mutability explanation, thread safety details, notes |

## Components Available

- `<ApiFunctionRenderer :data="funcData" />` - Renders YAML data
- `<Badge>` - Version/status badges
- `<Callout>` - Info/warning/tip boxes
- `<SeeAlso>` - Related links
- `<SupportMatrix>` - Feature support table
